<?xml version="1.0" encoding="UTF-8"?>
<BatchCalcJobDefinition xmlns="http://soap.sforce.com/2006/04/metadata">
    <aggregates>
        <fields>
            <aggregateFunction>Sum</aggregateFunction>
            <alias>TotalRewardPointsCalculated</alias>
            <sourceFieldName>FaceValue</sourceFieldName>
        </fields>
        <groupBy>LoyaltyProgramMemberId</groupBy>
        <label>Group Voucher based on Loyalty Program Member</label>
        <name>Group_Voucher_based_on_Loyalty_Program_Member</name>
        <sourceName>Join_Voucher_with_Loyalty_Program_Member</sourceName>
    </aggregates>
    <dataSpaceApiName>default</dataSpaceApiName>
    <datasources>
        <fields>
            <alias>Id</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>MemberStatus</name>
        </fields>
        <fields>
            <alias>ProgramId</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>ProgramId</name>
        </fields>
        <fields>
            <alias>Total_Rewards_c</alias>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Total_Rewards__c</name>
        </fields>
        <label>LoyaltyProgramMember</label>
        <name>LoyaltyProgramMember</name>
        <sourceName>LoyaltyProgramMember</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <fields>
            <alias>Id</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <alias>Name</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Name</name>
        </fields>
        <label>Loyalty Program</label>
        <name>Loyalty_Program</name>
        <sourceName>LoyaltyProgram</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <fields>
            <alias>CreatedDate</alias>
            <dataType>DateTime</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>CreatedDate</name>
        </fields>
        <fields>
            <alias>FaceValue</alias>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>FaceValue</name>
        </fields>
        <fields>
            <alias>LoyaltyProgramMemberId</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyProgramMemberId</name>
        </fields>
        <fields>
            <alias>Status</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Status</name>
        </fields>
        <fields>
            <alias>VoucherDefinitionId</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>VoucherDefinitionId</name>
        </fields>
        <label>Voucher</label>
        <name>Voucher</name>
        <sourceName>Voucher</sourceName>
        <type>StandardObject</type>
    </datasources>
    <executionPlatformType>CRMA</executionPlatformType>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>Name</sourceFieldName>
            <value>Just Shop</value>
        </criteria>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter by program name</label>
        <name>Filter_by_program_name</name>
        <sourceName>Loyalty_Program</sourceName>
    </filters>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>Status</sourceFieldName>
            <value>Issued</value>
        </criteria>
        <criteria>
            <inputVariable>lastOneHour</inputVariable>
            <operator>GreaterThanOrEquals</operator>
            <sequence>2</sequence>
            <sourceFieldName>CreatedDate</sourceFieldName>
        </criteria>
        <filterCondition>1 AND 2</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Issued Vouchers</label>
        <name>Issued_Vouchers</name>
        <sourceName>Voucher</sourceName>
    </filters>
    <isTemplate>false</isTemplate>
    <joins>
        <fields>
            <alias>FaceValue</alias>
            <sourceFieldName>FaceValue</sourceFieldName>
            <sourceName>Issued_Vouchers</sourceName>
        </fields>
        <fields>
            <alias>Id</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>Just_Group_Loyalty_Program_Members</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyProgramMemberId</alias>
            <sourceFieldName>LoyaltyProgramMemberId</sourceFieldName>
            <sourceName>Issued_Vouchers</sourceName>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <sourceFieldName>MemberStatus</sourceFieldName>
            <sourceName>Just_Group_Loyalty_Program_Members</sourceName>
        </fields>
        <fields>
            <alias>Name</alias>
            <sourceFieldName>Name</sourceFieldName>
            <sourceName>Just_Group_Loyalty_Program_Members</sourceName>
        </fields>
        <fields>
            <alias>ProgramId</alias>
            <sourceFieldName>ProgramId</sourceFieldName>
            <sourceName>Just_Group_Loyalty_Program_Members</sourceName>
        </fields>
        <fields>
            <alias>Status</alias>
            <sourceFieldName>Status</sourceFieldName>
            <sourceName>Issued_Vouchers</sourceName>
        </fields>
        <fields>
            <alias>Total_Rewards_c</alias>
            <sourceFieldName>Total_Rewards_c</sourceFieldName>
            <sourceName>Just_Group_Loyalty_Program_Members</sourceName>
        </fields>
        <fields>
            <alias>VoucherDefinitionId</alias>
            <sourceFieldName>VoucherDefinitionId</sourceFieldName>
            <sourceName>Issued_Vouchers</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>LoyaltyProgramMemberId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Join Voucher with Loyalty Program Member</label>
        <name>Join_Voucher_with_Loyalty_Program_Member</name>
        <primarySourceName>Issued_Vouchers</primarySourceName>
        <secondarySourceName>Just_Group_Loyalty_Program_Members</secondarySourceName>
        <type>Inner</type>
    </joins>
    <joins>
        <fields>
            <alias>Id</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>LoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyprogramId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>Filter_by_program_name</sourceName>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <sourceFieldName>MemberStatus</sourceFieldName>
            <sourceName>LoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>Name</alias>
            <sourceFieldName>Name</sourceFieldName>
            <sourceName>Filter_by_program_name</sourceName>
        </fields>
        <fields>
            <alias>ProgramId</alias>
            <sourceFieldName>ProgramId</sourceFieldName>
            <sourceName>LoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>Total_Rewards_c</alias>
            <sourceFieldName>Total_Rewards_c</sourceFieldName>
            <sourceName>LoyaltyProgramMember</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>ProgramId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Just Group Loyalty Program Members</label>
        <name>Just_Group_Loyalty_Program_Members</name>
        <primarySourceName>LoyaltyProgramMember</primarySourceName>
        <secondarySourceName>Filter_by_program_name</secondarySourceName>
        <type>Inner</type>
    </joins>
    <label>Updates total reward points fields on member</label>
    <parameters>
        <dataType>DateTime</dataType>
        <isMultiValue>false</isMultiValue>
        <label>lastOneHour</label>
        <name>lastOneHour</name>
    </parameters>
    <processType>Loyalty</processType>
    <status>Active</status>
    <writebacks>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyProgramMemberId</sourceFieldName>
            <targetFieldName>Id</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>TotalRewardPointsCalculated</sourceFieldName>
            <targetFieldName>Total_Rewards__c</targetFieldName>
        </fields>
        <isChangedRow>true</isChangedRow>
        <label>Update total points on member</label>
        <name>Update_total_points_on_member</name>
        <operationType>Update</operationType>
        <sourceName>Group_Voucher_based_on_Loyalty_Program_Member</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>LoyaltyProgramMember</targetObjectName>
        <writebackSequence>1</writebackSequence>
        <writebackUser>005Hp00000hfFcWIAU</writebackUser>
    </writebacks>
</BatchCalcJobDefinition>
